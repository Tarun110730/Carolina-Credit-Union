<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cold Email Prompt Generator (CSV Synced)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1, h2 {
            color: #333;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .hidden {
            display: none;
        }
        .prompt-output {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin-top: 20px;
            white-space: pre-wrap;
            font-family: monospace;
        }
        .person-info {
            background-color: #e9ecef;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
        }
        .sync-status {
            background-color: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            font-size: 14px;
        }
        .csv-update-info {
            background-color: #fff3cd;
            color: #856404;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Cold Email Prompt Generator (CSV Synced)</h1>
        
        <!-- Step 1: User Info Form -->
        <div id="user-form">
            <h2>Step 1: Enter Your Info</h2>
            <div class="form-group">
                <label for="yourName">Your Full Name:</label>
                <input type="text" id="yourName" required>
            </div>
            <div class="form-group">
                <label for="yourYear">Your Year:</label>
                <input type="text" id="yourYear" required placeholder="e.g., senior, junior, sophomore, freshman">
            </div>
            <div class="form-group">
                <label for="yourCollege">Your College in UNC (optional):</label>
                <input type="text" id="yourCollege" placeholder="e.g., Kenan-Flagler Business School">
            </div>
            <button onclick="nextStep()">Continue</button>
        </div>

        <!-- Step 2: Person Selection -->
        <div id="person-selection" class="hidden">
            <h2>Step 2: Select Person</h2>
            <div class="person-info" id="user-info-display"></div>
            <div class="sync-status" id="sync-status">Loading data...</div>
            <div class="csv-update-info" id="csv-update-info">
                <strong>Note:</strong> When you delete someone, their status will be marked as "Reachout Sent" in the CSV. 
                You'll need to commit and push the updated CSV to GitHub for others to see the changes.
            </div>
            
            <div class="form-group">
                <label for="personSelect">Select Person:</label>
                <select id="personSelect" required>
                    <option value="">Choose a person...</option>
                </select>
                <button type="button" onclick="deleteSelectedPerson()" style="background-color: #dc3545; margin-top: 10px;">Delete Selected Person</button>
                <button type="button" onclick="undoLastDelete()" style="background-color: #28a745; margin-top: 10px; margin-left: 10px;">Undo Last Delete</button>
            </div>
            
            <div class="form-group">
                <label for="googleNotes">Notes from Google Search (optional):</label>
                <textarea id="googleNotes" rows="4" placeholder="Enter any notes you found from researching this person online..."></textarea>
            </div>
            
            <button onclick="generatePrompt()">Generate Prompt</button>
            <button onclick="backToStep1()" style="background-color: #6c757d;">Back</button>
        </div>

        <!-- Step 3: Generated Prompt -->
        <div id="prompt-output" class="hidden">
            <h2>Generated ChatGPT Prompt</h2>
            <div class="prompt-output" id="promptText"></div>
            <button onclick="copyPrompt()">Copy to Clipboard</button>
            <button onclick="startOver()" style="background-color: #6c757d;">Start Over</button>
        </div>
    </div>

    <script src='people_data.js'></script>
    <script>
        let currentUser = {};
        let deletedPeople = [];
        let originalPeople = [];

        // Add error handling and debugging
        window.onerror = function(msg, url, lineNo, columnNo, error) {
            console.error('JavaScript Error:', msg, 'at', url, 'line', lineNo);
            alert('JavaScript Error: ' + msg + '\nCheck console for details.');
            return false;
        };

        // Check if people data is loaded
        window.addEventListener('load', function() {
            if (typeof people === 'undefined') {
                console.error('people data not loaded');
                alert('Error: People data not loaded. Please check if people_data.js exists.');
            } else {
                console.log('People data loaded successfully:', people.length, 'people');
            }
        });

        function nextStep() {
            try {
                const name = document.getElementById('yourName').value.trim();
                const year = document.getElementById('yourYear').value.trim().toLowerCase();
                const college = document.getElementById('yourCollege').value.trim();

                if (!name || !year) {
                    alert('Please fill in your name and year.');
                    return;
                }

                currentUser = {
                    yourName: name,
                    yourYear: year,
                    yourCollegeinUNC: college
                };

                // Load data and filter out people with "Reachout Sent" status
                loadFilteredData();

                // Show user info
                document.getElementById('user-info-display').textContent = 
                    `User: ${name}, ${year}, ${college || 'UNC Chapel Hill'}`;

                document.getElementById('user-form').classList.add('hidden');
                document.getElementById('person-selection').classList.remove('hidden');
            } catch (error) {
                console.error('Error in nextStep:', error);
                alert('Error: ' + error.message);
            }
        }

        function loadFilteredData() {
            try {
                // Check if people data exists
                if (typeof people === 'undefined' || !Array.isArray(people)) {
                    throw new Error('People data not available');
                }
                
                // Store original people list
                originalPeople = [...people];
                
                // Filter out people with "Reachout Sent" status
                people = people.filter(person => {
                    return !person['Status'] || person['Status'].trim() === '';
                });
                
                updateDropdown();
                updateSyncStatus();
                
                console.log('Filtered data loaded:', people.length, 'available people');
            } catch (error) {
                console.error('Error in loadFilteredData:', error);
                alert('Error loading data: ' + error.message);
            }
        }

        function updateDropdown() {
            try {
                const select = document.getElementById('personSelect');
                if (!select) {
                    throw new Error('Person select element not found');
                }
                
                select.innerHTML = '<option value="">Choose a person...</option>';
                
                if (Array.isArray(people)) {
                    people.forEach(person => {
                        const option = document.createElement('option');
                        option.value = person['Full Name'];
                        option.textContent = `${person['Full Name']} - ${person['Job Title']} at ${person['Employer']}`;
                        select.appendChild(option);
                    });
                }
                
                console.log('Dropdown updated with', people.length, 'people');
            } catch (error) {
                console.error('Error in updateDropdown:', error);
                alert('Error updating dropdown: ' + error.message);
            }
        }

        function updateSyncStatus() {
            try {
                const statusElement = document.getElementById('sync-status');
                if (!statusElement) {
                    throw new Error('Status element not found');
                }
                
                const totalPeople = originalPeople.length;
                const availablePeople = people.length;
                const deletedCount = totalPeople - availablePeople;
                
                statusElement.textContent = `Available: ${availablePeople} people, ${deletedCount} marked as "Reachout Sent"`;
                
                console.log('Status updated:', availablePeople, 'available,', deletedCount, 'deleted');
            } catch (error) {
                console.error('Error in updateSyncStatus:', error);
                alert('Error updating status: ' + error.message);
            }
        }

        function deleteSelectedPerson() {
            const selectedName = document.getElementById('personSelect').value;
            if (!selectedName) {
                alert('Please select a person to delete.');
                return;
            }
            
            if (confirm(`Are you sure you want to mark ${selectedName} as "Reachout Sent"?`)) {
                const personToDelete = people.find(p => p['Full Name'] === selectedName);
                if (personToDelete) {
                    // Mark as "Reachout Sent" in the original data
                    const originalPerson = originalPeople.find(p => p['Full Name'] === selectedName);
                    if (originalPerson) {
                        originalPerson['Status'] = 'Reachout Sent';
                    }
                    
                    // Remove from current people array
                    const index = people.findIndex(p => p['Full Name'] === selectedName);
                    people.splice(index, 1);
                    
                    // Add to deleted people array for undo
                    deletedPeople.push(personToDelete);
                    
                    updateDropdown();
                    updateSyncStatus();
                    
                    alert(`${selectedName} has been marked as "Reachout Sent". Remember to commit and push the updated CSV to GitHub!`);
                }
            }
        }

        function undoLastDelete() {
            if (deletedPeople.length === 0) {
                alert('No deleted people to restore.');
                return;
            }
            
            const personToRestore = deletedPeople.pop();
            
            // Clear status in original data
            const originalPerson = originalPeople.find(p => p['Full Name'] === personToRestore['Full Name']);
            if (originalPerson) {
                originalPerson['Status'] = '';
            }
            
            // Add back to people array
            people.push(personToRestore);
            
            updateDropdown();
            updateSyncStatus();
            
            alert(`${personToRestore['Full Name']} has been restored. Remember to commit and push the updated CSV to GitHub!`);
        }

        function backToStep1() {
            document.getElementById('person-selection').classList.add('hidden');
            document.getElementById('user-form').classList.remove('hidden');
        }

        function generatePrompt() {
            const selectedName = document.getElementById('personSelect').value;
            const googleNotes = document.getElementById('googleNotes').value.trim();

            if (!selectedName) {
                alert('Please select a person.');
                return;
            }

            const person = people.find(p => p['Full Name'] === selectedName);
            if (!person) {
                alert('Person not found.');
                return;
            }

            const collegeStr = currentUser.yourCollegeinUNC ? 
                `UNC Chapel Hill's ${currentUser.yourCollegeinUNC}` : 
                "UNC Chapel Hill";

            let notesSection = "";
            if (googleNotes) {
                notesSection = `\nHere are the notes from the google search query about ${person['Full Name']}:\n\n${googleNotes}\n`;
            }

            const prompt = `Please help me generate a personalized cold email for ${person['Full Name']} based on the following information:

Google Search URL: ${person['Google Search Query']}${notesSection}

Using this information and any additional context you can provide, generate a personalized cold email using the following template (fill in the brackets with the appropriate information):

My name is ${currentUser.yourName}, and I'm a ${currentUser.yourYear} at ${collegeStr}, reaching out on behalf of a passionate team of 20+ students working to launch UNC's first student-run federal credit union. Inspired by successful models like Georgetown University's student credit union, our initiative aims to empower students through practical financial literacy, affordable banking services, and meaningful hands-on experience.

To turn our vision into reality, we're currently raising an initial $100,000 to cover regulatory and setup costs. We're seeking donations from alumni or others who share our commitment to financial empowerment, education, and community impact. Your support would help us provide:

- No-fee student checking and savings accounts
- Unique credit-building products to improve student financial health
- On-campus financial literacy education
- Leadership and professional growth opportunities for UNC students

We believe your support could provide substantial mutual benefits, including prominent brand visibility and recognition as a foundational supporter of UNC student success.

Thank you for considering this opportunity to shape the future of student finance at UNC. I look forward to hearing from you soon!

Warm regards,
${currentUser.yourName}
Carolina Credit Union Initiative`;

            document.getElementById('promptText').textContent = prompt;
            document.getElementById('person-selection').classList.add('hidden');
            document.getElementById('prompt-output').classList.remove('hidden');
        }

        function copyPrompt() {
            const promptText = document.getElementById('promptText').textContent;
            navigator.clipboard.writeText(promptText).then(() => {
                alert('Prompt copied to clipboard!');
            }).catch(err => {
                console.error('Failed to copy: ', err);
                alert('Failed to copy to clipboard. Please select and copy manually.');
            });
        }

        function startOver() {
            document.getElementById('person-selection').classList.remove('hidden');
            document.getElementById('prompt-output').classList.add('hidden');
            
            document.getElementById('personSelect').value = '';
            document.getElementById('googleNotes').value = '';
        }
    </script>
</body>
</html> 