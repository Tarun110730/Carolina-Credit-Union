<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cold Email Prompt Generator (CSV Synced)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1, h2 {
            color: #333;
        }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        button {
            background-color: #007bff;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .hidden {
            display: none;
        }
        .prompt-output {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            margin-top: 20px;
            white-space: pre-wrap;
            font-family: monospace;
        }
        .person-info {
            background-color: #e9ecef;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
        }
        .sync-status {
            background-color: #d4edda;
            color: #155724;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            font-size: 14px;
        }
        .csv-update-info {
            background-color: #fff3cd;
            color: #856404;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            font-size: 14px;
        }
        
        /* Tab Styles */
        .tab-navigation {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .tab-button {
            background-color: #6c757d;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        .tab-button.active {
            background-color: #007bff;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        
        /* Admin Panel Styles */
        .admin-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .stat-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border-left: 4px solid #007bff;
        }
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #007bff;
        }
        .search-section {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        .search-box {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            margin-bottom: 10px;
        }
        .person-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: white;
        }
        .person-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .person-item:last-child {
            border-bottom: none;
        }
        .person-info {
            flex: 1;
        }
        .person-name {
            font-weight: bold;
        }
        .person-details {
            color: #666;
            font-size: 0.9em;
        }
        .status-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
        }
        .status-available {
            background: #d4edda;
            color: #155724;
        }
        .status-contacted {
            background: #f8d7da;
            color: #721c24;
        }
        .action-buttons {
            display: flex;
            gap: 10px;
        }
        .btn-danger {
            background-color: #dc3545;
        }
        .btn-danger:hover {
            background-color: #c82333;
        }
        .btn-success {
            background-color: #28a745;
        }
        .btn-success:hover {
            background-color: #218838;
        }
        .filter-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        .filter-tab {
            padding: 8px 16px;
            border: 1px solid #ddd;
            background: white;
            cursor: pointer;
            border-radius: 5px;
        }
        .filter-tab.active {
            background: #007bff;
            color: white;
            border-color: #007bff;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Tab Navigation -->
        <div class="tab-navigation">
            <button class="tab-button active" onclick="switchTab('email-generator')">ðŸ“§ Email Generator</button>
            <button class="tab-button" onclick="switchTab('admin-panel')">ðŸ“Š Admin Panel</button>
        </div>
        
        <!-- Email Generator Tab -->
        <div id="email-generator" class="tab-content active">
            <h1>Cold Email Prompt Generator (CSV Synced)</h1>
            
            <!-- Step 1: User Info Form -->
            <div id="user-form">
            <h2>Step 1: Enter Your Info</h2>
            <div class="form-group">
                <label for="yourName">Your Full Name:</label>
                <input type="text" id="yourName" required>
            </div>
            <div class="form-group">
                <label for="yourYear">Your Year:</label>
                <input type="text" id="yourYear" required placeholder="e.g., senior, junior, sophomore, freshman">
            </div>
            <div class="form-group">
                <label for="yourCollege">Your College in UNC (optional):</label>
                <input type="text" id="yourCollege" placeholder="e.g., Kenan-Flagler Business School">
            </div>
            <button onclick="nextStep()">Continue</button>
        </div>

        <!-- Step 2: Person Selection -->
        <div id="person-selection" class="hidden">
            <h2>Step 2: Select Person</h2>
            <div class="person-info" id="user-info-display"></div>
            <div class="sync-status" id="sync-status">Loading data...</div>
            <div class="csv-update-info" id="csv-update-info">
                <strong>Note:</strong> When you delete someone, their status will be marked as "Reachout Sent" in the CSV. 
                You'll need to commit and push the updated CSV to GitHub for others to see the changes.
            </div>
            
            <div class="form-group">
                <label for="personSelect">Select Person:</label>
                <select id="personSelect" required>
                    <option value="">Choose a person...</option>
                </select>
                <button type="button" onclick="deleteSelectedPerson()" style="background-color: #dc3545; margin-top: 10px;">Delete Selected Person</button>
                <button type="button" onclick="undoLastDelete()" style="background-color: #28a745; margin-top: 10px; margin-left: 10px;">Undo Last Delete</button>
            </div>
            
            <div class="form-group">
                <label for="googleNotes">Notes from Google Search (optional):</label>
                <textarea id="googleNotes" rows="4" placeholder="Enter any notes you found from researching this person online..."></textarea>
            </div>
            
            <button onclick="generatePrompt()">Generate Prompt</button>
            <button onclick="backToStep1()" style="background-color: #6c757d;">Back</button>
        </div>

        <!-- Step 3: Generated Prompt -->
        <div id="prompt-output" class="hidden">
            <h2>Generated ChatGPT Prompt</h2>
            <div class="prompt-output" id="promptText"></div>
            <button onclick="copyPrompt()">Copy to Clipboard</button>
            <button onclick="startOver()" style="background-color: #6c757d;">Start Over</button>
        </div>
        </div>
        
        <!-- Admin Panel Tab -->
        <div id="admin-panel" class="tab-content">
            <h1>ðŸ“Š Admin Panel - CSV Management</h1>
            
            <!-- Statistics -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-number" id="total-people">-</div>
                    <div>Total People</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="available-people">-</div>
                    <div>Available</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="contacted-people">-</div>
                    <div>Contacted</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="sync-status">-</div>
                    <div>Last Sync</div>
                </div>
            </div>

            <!-- Search and Filter -->
            <div class="search-section">
                <h2>ðŸ‘¥ People Management</h2>
                <input type="text" class="search-box" id="admin-search-box" placeholder="Search by name, job title, or employer...">
                
                <div class="filter-tabs">
                    <div class="filter-tab active" onclick="filterPeople('all')">All People</div>
                    <div class="filter-tab" onclick="filterPeople('available')">Available</div>
                    <div class="filter-tab" onclick="filterPeople('contacted')">Contacted</div>
                </div>

                <div class="person-list" id="admin-person-list">
                    <!-- People will be loaded here -->
                </div>
            </div>

            <!-- Bulk Actions -->
            <div class="search-section">
                <h2>âš¡ Bulk Actions</h2>
                <p>Quick actions for managing multiple people at once.</p>
                <div class="action-buttons">
                    <button onclick="exportCSV()" class="btn-success">Export Current Data</button>
                    <button onclick="resetAllStatus()" class="btn-danger">Reset All Status</button>
                </div>
            </div>
        </div>
    </div>

    <script src='people_data.js'></script>
    <script>
        let currentUser = {};
        let deletedPeople = [];
        let originalPeople = [];
        let allPeople = [];
        let filteredPeople = [];
        let currentFilter = 'all';

        // Add error handling and debugging
        window.onerror = function(msg, url, lineNo, columnNo, error) {
            console.error('JavaScript Error:', msg, 'at', url, 'line', lineNo);
            alert('JavaScript Error: ' + msg + '\nCheck console for details.');
            return false;
        };

        // Check if people data is loaded
        window.addEventListener('load', function() {
            if (typeof people === 'undefined') {
                console.error('people data not loaded');
                alert('Error: People data not loaded. Please check if people_data.js exists.');
            } else {
                console.log('People data loaded successfully:', people.length, 'people');
                allPeople = people;
                filteredPeople = [...allPeople];
                updateAdminStats();
                displayAdminPeople();
            }
        });

        function nextStep() {
            try {
                const name = document.getElementById('yourName').value.trim();
                const year = document.getElementById('yourYear').value.trim().toLowerCase();
                const college = document.getElementById('yourCollege').value.trim();

                if (!name || !year) {
                    alert('Please fill in your name and year.');
                    return;
                }

                currentUser = {
                    yourName: name,
                    yourYear: year,
                    yourCollegeinUNC: college
                };

                // Load data and filter out people with "Reachout Sent" status
                loadFilteredData();

                // Show user info
                document.getElementById('user-info-display').textContent = 
                    `User: ${name}, ${year}, ${college || 'UNC Chapel Hill'}`;

                document.getElementById('user-form').classList.add('hidden');
                document.getElementById('person-selection').classList.remove('hidden');
            } catch (error) {
                console.error('Error in nextStep:', error);
                alert('Error: ' + error.message);
            }
        }

        function loadFilteredData() {
            try {
                // Check if people data exists
                if (typeof people === 'undefined' || !Array.isArray(people)) {
                    throw new Error('People data not available');
                }
                
                // Store original people list
                originalPeople = [...people];
                
                // Create filtered list instead of reassigning people
                const availablePeople = people.filter(person => {
                    return !person['Status'] || person['Status'].trim() === '';
                });
                
                // Update the global people array reference
                window.availablePeople = availablePeople;
                
                updateDropdown();
                updateSyncStatus();
                
                console.log('Filtered data loaded:', availablePeople.length, 'available people');
            } catch (error) {
                console.error('Error in loadFilteredData:', error);
                alert('Error loading data: ' + error.message);
            }
        }

        function updateDropdown() {
            try {
                const select = document.getElementById('personSelect');
                if (!select) {
                    throw new Error('Person select element not found');
                }
                
                select.innerHTML = '<option value="">Choose a person...</option>';
                
                // Use the filtered available people
                const availablePeople = window.availablePeople || people;
                
                if (Array.isArray(availablePeople)) {
                    availablePeople.forEach(person => {
                        const option = document.createElement('option');
                        option.value = person['Full Name'];
                        option.textContent = `${person['Full Name']} - ${person['Job Title']} at ${person['Employer']}`;
                        select.appendChild(option);
                    });
                }
                
                console.log('Dropdown updated with', availablePeople.length, 'people');
            } catch (error) {
                console.error('Error in updateDropdown:', error);
                alert('Error updating dropdown: ' + error.message);
            }
        }

        function updateSyncStatus() {
            try {
                const statusElement = document.getElementById('sync-status');
                if (!statusElement) {
                    throw new Error('Status element not found');
                }
                
                const totalPeople = originalPeople.length;
                const availablePeople = window.availablePeople || people;
                const availableCount = availablePeople.length;
                const deletedCount = totalPeople - availableCount;
                
                statusElement.textContent = `Available: ${availableCount} people, ${deletedCount} marked as "Reachout Sent"`;
                
                console.log('Status updated:', availableCount, 'available,', deletedCount, 'deleted');
            } catch (error) {
                console.error('Error in updateSyncStatus:', error);
                alert('Error updating status: ' + error.message);
            }
        }

        function deleteSelectedPerson() {
            const selectedName = document.getElementById('personSelect').value;
            if (!selectedName) {
                alert('Please select a person to delete.');
                return;
            }
            
            if (confirm(`Are you sure you want to mark ${selectedName} as "Reachout Sent"?`)) {
                const availablePeople = window.availablePeople || people;
                const personToDelete = availablePeople.find(p => p['Full Name'] === selectedName);
                if (personToDelete) {
                    // Mark as "Reachout Sent" in the original data
                    const originalPerson = originalPeople.find(p => p['Full Name'] === selectedName);
                    if (originalPerson) {
                        originalPerson['Status'] = 'Reachout Sent';
                    }
                    
                    // Remove from available people array
                    const index = availablePeople.findIndex(p => p['Full Name'] === selectedName);
                    availablePeople.splice(index, 1);
                    
                    // Add to deleted people array for undo
                    deletedPeople.push(personToDelete);
                    
                    updateDropdown();
                    updateSyncStatus();
                    
                    alert(`${selectedName} has been marked as "Reachout Sent". Remember to commit and push the updated CSV to GitHub!`);
                }
            }
        }

        function undoLastDelete() {
            if (deletedPeople.length === 0) {
                alert('No deleted people to restore.');
                return;
            }
            
            const personToRestore = deletedPeople.pop();
            
            // Clear status in original data
            const originalPerson = originalPeople.find(p => p['Full Name'] === personToRestore['Full Name']);
            if (originalPerson) {
                originalPerson['Status'] = '';
            }
            
            // Add back to available people array
            const availablePeople = window.availablePeople || people;
            availablePeople.push(personToRestore);
            
            updateDropdown();
            updateSyncStatus();
            
            alert(`${personToRestore['Full Name']} has been restored. Remember to commit and push the updated CSV to GitHub!`);
        }

        function backToStep1() {
            document.getElementById('person-selection').classList.add('hidden');
            document.getElementById('user-form').classList.remove('hidden');
        }

        function generatePrompt() {
            const selectedName = document.getElementById('personSelect').value;
            const googleNotes = document.getElementById('googleNotes').value.trim();

            if (!selectedName) {
                alert('Please select a person.');
                return;
            }

            const availablePeople = window.availablePeople || people;
            const person = availablePeople.find(p => p['Full Name'] === selectedName);
            if (!person) {
                alert('Person not found.');
                return;
            }

            const collegeStr = currentUser.yourCollegeinUNC ? 
                `UNC Chapel Hill's ${currentUser.yourCollegeinUNC}` : 
                "UNC Chapel Hill";

            let notesSection = "";
            if (googleNotes) {
                notesSection = `\nHere are the notes from the google search query about ${person['Full Name']}:\n\n${googleNotes}\n`;
            }

            const prompt = `Please help me generate a personalized cold email for ${person['Full Name']} based on the following information:

Google Search URL: ${person['Google Search Query']}${notesSection}

Using this information and any additional context you can provide, generate a personalized cold email using the following template (fill in the brackets with the appropriate information):

My name is ${currentUser.yourName}, and I'm a ${currentUser.yourYear} at ${collegeStr}, reaching out on behalf of a passionate team of 20+ students working to launch UNC's first student-run federal credit union. Inspired by successful models like Georgetown University's student credit union, our initiative aims to empower students through practical financial literacy, affordable banking services, and meaningful hands-on experience.

To turn our vision into reality, we're currently raising an initial $100,000 to cover regulatory and setup costs. We're seeking donations from alumni or others who share our commitment to financial empowerment, education, and community impact. Your support would help us provide:

- No-fee student checking and savings accounts
- Unique credit-building products to improve student financial health
- On-campus financial literacy education
- Leadership and professional growth opportunities for UNC students

We believe your support could provide substantial mutual benefits, including prominent brand visibility and recognition as a foundational supporter of UNC student success.

Thank you for considering this opportunity to shape the future of student finance at UNC. I look forward to hearing from you soon!

Warm regards,
${currentUser.yourName}
Carolina Credit Union Initiative`;

            document.getElementById('promptText').textContent = prompt;
            document.getElementById('person-selection').classList.add('hidden');
            document.getElementById('prompt-output').classList.remove('hidden');
        }

        function copyPrompt() {
            const promptText = document.getElementById('promptText').textContent;
            navigator.clipboard.writeText(promptText).then(() => {
                alert('Prompt copied to clipboard!');
            }).catch(err => {
                console.error('Failed to copy: ', err);
                alert('Failed to copy to clipboard. Please select and copy manually.');
            });
        }

        function startOver() {
            document.getElementById('person-selection').classList.remove('hidden');
            document.getElementById('prompt-output').classList.add('hidden');
            
            document.getElementById('personSelect').value = '';
            document.getElementById('googleNotes').value = '';
        }

        // Tab switching function
        function switchTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all tab buttons
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabName).classList.add('active');
            
            // Add active class to clicked button
            event.target.classList.add('active');
        }

        // Admin Panel Functions
        function updateAdminStats() {
            const total = allPeople.length;
            const available = allPeople.filter(p => !p['Status'] || p['Status'].trim() === '').length;
            const contacted = total - available;

            document.getElementById('total-people').textContent = total;
            document.getElementById('available-people').textContent = available;
            document.getElementById('contacted-people').textContent = contacted;
            document.getElementById('sync-status').textContent = 'Ready';
        }

        function displayAdminPeople() {
            const container = document.getElementById('admin-person-list');
            container.innerHTML = '';

            filteredPeople.forEach(person => {
                const isContacted = person['Status'] && person['Status'].trim() === 'Reachout Sent';
                const statusClass = isContacted ? 'status-contacted' : 'status-available';
                const statusText = isContacted ? 'Contacted' : 'Available';

                const personDiv = document.createElement('div');
                personDiv.className = 'person-item';
                personDiv.innerHTML = `
                    <div class="person-info">
                        <div class="person-name">${person['Full Name']}</div>
                        <div class="person-details">${person['Job Title']} at ${person['Employer']}</div>
                    </div>
                    <div class="action-buttons">
                        <span class="status-badge ${statusClass}">${statusText}</span>
                        ${isContacted ? 
                            `<button onclick="markAvailable('${person['Full Name']}')" class="btn-success">Mark Available</button>` :
                            `<button onclick="markContacted('${person['Full Name']}')" class="btn-danger">Mark Contacted</button>`
                        }
                    </div>
                `;
                container.appendChild(personDiv);
            });
        }

        function filterPeople(filter) {
            currentFilter = filter;
            
            // Update active tab
            document.querySelectorAll('.filter-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');

            // Filter people
            switch(filter) {
                case 'available':
                    filteredPeople = allPeople.filter(p => !p['Status'] || p['Status'].trim() === '');
                    break;
                case 'contacted':
                    filteredPeople = allPeople.filter(p => p['Status'] && p['Status'].trim() === 'Reachout Sent');
                    break;
                default:
                    filteredPeople = [...allPeople];
            }

            displayAdminPeople();
        }

        // Search functionality for admin panel
        document.addEventListener('DOMContentLoaded', function() {
            const searchBox = document.getElementById('admin-search-box');
            if (searchBox) {
                searchBox.addEventListener('input', function(e) {
                    const searchTerm = e.target.value.toLowerCase();
                    
                    let searchResults = allPeople;
                    if (currentFilter === 'available') {
                        searchResults = allPeople.filter(p => !p['Status'] || p['Status'].trim() === '');
                    } else if (currentFilter === 'contacted') {
                        searchResults = allPeople.filter(p => p['Status'] && p['Status'].trim() === 'Reachout Sent');
                    }

                    filteredPeople = searchResults.filter(person => 
                        person['Full Name'].toLowerCase().includes(searchTerm) ||
                        person['Job Title'].toLowerCase().includes(searchTerm) ||
                        person['Employer'].toLowerCase().includes(searchTerm)
                    );

                    displayAdminPeople();
                });
            }
        });

        function markContacted(name) {
            const person = allPeople.find(p => p['Full Name'] === name);
            if (person) {
                person['Status'] = 'Reachout Sent';
                updateAdminStats();
                displayAdminPeople();
                alert(`âœ… Marked ${name} as contacted`);
            }
        }

        function markAvailable(name) {
            const person = allPeople.find(p => p['Full Name'] === name);
            if (person) {
                person['Status'] = '';
                updateAdminStats();
                displayAdminPeople();
                alert(`âœ… Marked ${name} as available`);
            }
        }

        function exportCSV() {
            let csvContent = 'Class Year,Employer,Employer City,Employer State,Employer Country,Type,Job Title,Full Name,Post-Graduation Email Address,Google Search Query,Reachout Notes,Status\n';
            
            allPeople.forEach(person => {
                csvContent += `2013,${person['Employer']},City,State,USA,Full-Time,${person['Job Title']},${person['Full Name']},email@example.com,${person['Google Search Query']},,${person['Status'] || ''}\n`;
            });

            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'alumni_data_export.csv';
            a.click();
            window.URL.revokeObjectURL(url);

            alert('âœ… CSV exported successfully');
        }

        function resetAllStatus() {
            if (confirm('Are you sure you want to reset all statuses? This will mark everyone as available.')) {
                allPeople.forEach(person => {
                    person['Status'] = '';
                });
                updateAdminStats();
                displayAdminPeople();
                alert('âœ… Reset all statuses');
            }
        }
    </script>
</body>
</html> 